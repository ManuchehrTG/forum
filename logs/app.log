2025-12-08 10:43:07 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:08 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:10 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:11 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:13 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:15 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:19 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:27 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:40 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:46 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:48 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:50 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:51 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:53 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:43:56 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:01 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:09 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:09 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 10:44:10 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 10:44:11 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:12 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 10:44:12 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 10:44:13 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:14 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 10:44:14 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 10:44:16 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:16 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 10:44:16 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 10:44:19 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:19 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 10:44:19 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 10:44:22 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:23 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 10:44:23 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 10:44:27 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 10:44:28 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 10:44:28 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 10:53:12 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 10:53:12 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 11:09:51 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 11:09:51 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 11:09:51 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 11:10:39 - root - WARNING - [handlers.py:28] - AppError: Invalid Telegram Mini App data (code: invalid_telegram_mini_app_data, status: 401)
2025-12-08 11:10:46 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 11:10:46 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 11:11:03 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 11:11:04 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 11:11:04 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 11:21:38 - root - ERROR - [handlers.py:64] - Unhandled exception name 'logger' is not defined
Traceback (most recent call last):
  File "/app/app/core/security/telegram.py", line 42, in verify_telegram
    msg=settings.BOT_TOKEN.encode(),
        ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/pydantic/main.py", line 1026, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Settings' object has no attribute 'BOT_TOKEN'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 316, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/endpoints.py", line 15, in telegram_login_endpoint
    token = await auth_service.telegram_login(payload=payload)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 23, in telegram_login
    tg_user = await self._telegram_auth(payload)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 15, in _telegram_auth
    user_data = verify_telegram(init_data=payload.init_data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/core/security/telegram.py", line 62, in verify_telegram
    logger.warning(f"Invalid Telegram data format: {e}")
    ^^^^^^
NameError: name 'logger' is not defined
2025-12-08 11:21:39 - root - WARNING - [handlers.py:54] - HTTPException: Not authenticated (status: 401)
2025-12-08 11:21:54 - root - ERROR - [handlers.py:64] - Unhandled exception name 'logger' is not defined
Traceback (most recent call last):
  File "/app/app/core/security/telegram.py", line 42, in verify_telegram
    msg=settings.BOT_TOKEN.encode(),
        ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/pydantic/main.py", line 1026, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Settings' object has no attribute 'BOT_TOKEN'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 316, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/endpoints.py", line 15, in telegram_login_endpoint
    token = await auth_service.telegram_login(payload=payload)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 23, in telegram_login
    tg_user = await self._telegram_auth(payload)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 15, in _telegram_auth
    user_data = verify_telegram(init_data=payload.init_data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/core/security/telegram.py", line 62, in verify_telegram
    logger.warning(f"Invalid Telegram data format: {e}")
    ^^^^^^
NameError: name 'logger' is not defined
2025-12-08 11:21:55 - root - WARNING - [handlers.py:54] - HTTPException: Not authenticated (status: 401)
2025-12-08 11:22:09 - root - ERROR - [handlers.py:64] - Unhandled exception name 'logger' is not defined
Traceback (most recent call last):
  File "/app/app/core/security/telegram.py", line 42, in verify_telegram
    msg=settings.BOT_TOKEN.encode(),
        ^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/pydantic/main.py", line 1026, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Settings' object has no attribute 'BOT_TOKEN'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 316, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/endpoints.py", line 15, in telegram_login_endpoint
    token = await auth_service.telegram_login(payload=payload)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 23, in telegram_login
    tg_user = await self._telegram_auth(payload)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 15, in _telegram_auth
    user_data = verify_telegram(init_data=payload.init_data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/core/security/telegram.py", line 62, in verify_telegram
    logger.warning(f"Invalid Telegram data format: {e}")
    ^^^^^^
NameError: name 'logger' is not defined
2025-12-08 11:22:52 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 11:22:52 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 11:22:57 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 11:22:57 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 11:22:58 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 11:22:58 - app - WARNING - [telegram.py:63] - Invalid Telegram data format: 'Settings' object has no attribute 'BOT_TOKEN'
2025-12-08 11:22:58 - root - WARNING - [handlers.py:28] - AppError: Invalid Telegram Mini App data (code: invalid_telegram_mini_app_data, status: 401)
2025-12-08 11:23:54 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 11:23:54 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 11:23:58 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 11:23:58 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 11:23:58 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 11:24:01 - root - ERROR - [handlers.py:64] - Unhandled exception relation "users" does not exist
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 316, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/endpoints.py", line 15, in telegram_login_endpoint
    token = await auth_service.telegram_login(payload=payload)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 26, in telegram_login
    user = await self.user_service.get_user(user_id=tg_user.id, provider="telegram")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/user/services/user.py", line 11, in get_user
    user = await UserRepository.get_user_by_provider_user_id(provider_user_id=user_id, provider=provider)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/user/repositories/user.py", line 33, in get_user_by_provider_user_id
    record = await db.fetchrow(
             ^^^^^^^^^^^^^^^^^^
  File "/app/infrastructure/database/manager.py", line 62, in fetchrow
    return await conn.fetchrow(query, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 752, in fetchrow
    data = await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 1873, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 1970, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 2013, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 443, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "users" does not exist
2025-12-08 11:24:22 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 11:24:22 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 11:26:24 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 11:26:25 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 11:26:25 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 11:26:28 - httpx - INFO - [_client.py:1740] - HTTP Request: GET https://t.me/i/userpic/320/AVZ0c2YDg7JkFugk1v1C5Os0TQ8ui19GB3XWxRdUOWU.svg "HTTP/1.1 200 OK"
2025-12-08 11:26:28 - root - ERROR - [handlers.py:64] - Unhandled exception module 'jwt' has no attribute 'encode'
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 316, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/endpoints.py", line 15, in telegram_login_endpoint
    token = await auth_service.telegram_login(payload=payload)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 43, in telegram_login
    return create_access_token({"sub": str(user.id), "provider": "telegram"})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/core/security/jwt.py", line 22, in create_access_token
    return jwt.encode(payload, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
           ^^^^^^^^^^
AttributeError: module 'jwt' has no attribute 'encode'
2025-12-08 11:29:16 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 11:29:16 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 11:29:20 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 11:29:20 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 11:29:21 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 11:29:29 - root - ERROR - [handlers.py:64] - Unhandled exception module 'jwt' has no attribute 'encode'
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 316, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/endpoints.py", line 15, in telegram_login_endpoint
    token = await auth_service.telegram_login(payload=payload)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/auth/services.py", line 43, in telegram_login
    return create_access_token({"sub": str(user.id), "provider": "telegram"})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/core/security/jwt_utils.py", line 22, in create_access_token
    return jwt.encode(payload, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
           ^^^^^^^^^^
AttributeError: module 'jwt' has no attribute 'encode'
2025-12-08 11:30:22 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 11:30:22 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 11:31:23 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 11:31:24 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 11:31:24 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 12:51:12 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 12:51:12 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 12:51:17 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 12:51:18 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 12:51:18 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 12:53:42 - root - WARNING - [handlers.py:28] - AppError: Section `chat_ideas` is not allowed. Allowed sections: chat_tasks, chat_experiments (code: validation_error_section_code, status: 422)
2025-12-08 12:53:54 - root - ERROR - [handlers.py:64] - Unhandled exception new row for relation "messages" violates check constraint "messages_type_check"
DETAIL:  Failing row contains (1, dc6c21ca-e6cc-4f45-9f5f-5e1ec6677f40, 1, chat_tasks, string, task, 2025-12-08 12:53:54.531434+00, 2025-12-08 12:53:54.531434+00).
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 316, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/message/endpoints.py", line 77, in create_message_task_endpoint
    message_with_task = await message_task_service.create_message_task(data=data, user=user, theme=theme, section=section)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/message/services/message_task.py", line 21, in create_message_task
    message = await self.message_service._create_message(data=data, user=user, theme=theme, section=section)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/message/services/message.py", line 43, in _create_message
    message = await MessageRepository.create_message(data=data, author_id=user.id, theme_id=theme.id, section_code=section.code)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/message/repositories/message.py", line 12, in create_message
    record = await db.fetchrow(
             ^^^^^^^^^^^^^^^^^^
  File "/app/infrastructure/database/manager.py", line 62, in fetchrow
    return await conn.fetchrow(query, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 752, in fetchrow
    data = await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 1873, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 1970, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 2033, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 205, in bind_execute
asyncpg.exceptions.CheckViolationError: new row for relation "messages" violates check constraint "messages_type_check"
DETAIL:  Failing row contains (1, dc6c21ca-e6cc-4f45-9f5f-5e1ec6677f40, 1, chat_tasks, string, task, 2025-12-08 12:53:54.531434+00, 2025-12-08 12:53:54.531434+00).
2025-12-08 12:58:11 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 12:58:11 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 12:58:17 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 12:58:17 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 12:58:17 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 12:59:24 - root - WARNING - [handlers.py:44] - Validation error: [{'type': 'int_type', 'loc': ('body', 'content_id'), 'msg': 'Input should be a valid integer', 'input': None}]
2025-12-08 13:00:04 - root - WARNING - [handlers.py:44] - Validation error: [{'type': 'missing', 'loc': ('body', 'text'), 'msg': 'Field required', 'input': {'type': 'post', 'is_openai_generated': False, 'ratio': 1}}]
2025-12-08 13:00:37 - root - WARNING - [handlers.py:44] - Validation error: [{'type': 'json_invalid', 'loc': ('body', 55), 'msg': 'JSON decode error', 'input': {}, 'ctx': {'error': "Expecting ',' delimiter"}}]
2025-12-08 18:06:58 - root - WARNING - [handlers.py:28] - AppError: Invalid token (code: invalid_token, status: 401)
2025-12-08 18:26:48 - root - ERROR - [handlers.py:64] - Unhandled exception new row for relation "messages" violates check constraint "messages_type_check"
DETAIL:  Failing row contains (3, dc6c21ca-e6cc-4f45-9f5f-5e1ec6677f40, 1, chat_tasks, test chat_tasks-task, task, 2025-12-08 18:26:48.312798+00, 2025-12-08 18:26:48.312798+00).
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 120, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 106, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 430, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 316, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/message/endpoints.py", line 77, in create_message_task_endpoint
    message_with_task = await message_task_service.create_message_task(data=data, user=user, theme=theme, section=section)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/message/services/message_task.py", line 21, in create_message_task
    message = await self.message_service._create_message(data=data, user=user, theme=theme, section=section)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/message/services/message.py", line 43, in _create_message
    message = await MessageRepository.create_message(data=data, author_id=user.id, theme_id=theme.id, section_code=section.code)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/app/domains/message/repositories/message.py", line 12, in create_message
    record = await db.fetchrow(
             ^^^^^^^^^^^^^^^^^^
  File "/app/infrastructure/database/manager.py", line 62, in fetchrow
    return await conn.fetchrow(query, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 752, in fetchrow
    data = await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 1873, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 1970, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/asyncpg/connection.py", line 2033, in _do_execute
    result = await executor(stmt, None)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 205, in bind_execute
asyncpg.exceptions.CheckViolationError: new row for relation "messages" violates check constraint "messages_type_check"
DETAIL:  Failing row contains (3, dc6c21ca-e6cc-4f45-9f5f-5e1ec6677f40, 1, chat_tasks, test chat_tasks-task, task, 2025-12-08 18:26:48.312798+00, 2025-12-08 18:26:48.312798+00).
2025-12-08 18:27:31 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-08 18:27:31 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
2025-12-08 18:28:32 - infrastructure.logger - INFO - [__init__.py:33] - 游 Logger initialized successfully
2025-12-08 18:28:33 - app - INFO - [main.py:21] - 游릭 Starting application...
2025-12-08 18:28:34 - database - INFO - [manager.py:37] - 游냊 Postgresql connected
2025-12-08 18:28:38 - httpx - INFO - [_client.py:1740] - HTTP Request: GET https://t.me/i/userpic/320/AVZ0c2YDg7JkFugk1v1C5Os0TQ8ui19GB3XWxRdUOWU.svg "HTTP/1.1 200 OK"
2025-12-08 18:30:58 - root - WARNING - [handlers.py:44] - Validation error: [{'type': 'int_type', 'loc': ('body', 'content_id'), 'msg': 'Input should be a valid integer', 'input': None}]
2025-12-08 18:34:53 - httpx - INFO - [_client.py:1740] - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-09 10:29:10 - app - INFO - [main.py:32] - 游댮 Shutting down...
2025-12-09 10:29:10 - database - INFO - [manager.py:42] - 游냊 PostgreSQL disconnected
